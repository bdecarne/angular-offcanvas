angular.module("angular.offcanvas",[]),angular.module("angular.offcanvas").directive("offcanvasBackdrop",["$offcanvasStack","$timeout",function(e,a){function n(n,t,r){n.animate=!1,n.close=function(a){var n=e.getTop();n&&n.value.backdrop&&"static"!=n.value.backdrop&&a.target===a.currentTarget&&(a.preventDefault(),a.stopPropagation(),e.dismiss(n.key,"backdrop click"))},a(function(){n.animate=!0})}return{restrict:"EA",replace:!0,templateUrl:"templates/offcanvas/backdrop.html",compile:function(e,a){return e.addClass(a.backdropClass),n}}}]),angular.module("angular.offcanvas").directive("offcanvasPane",["$offcanvasStack","$q","$timeout","$window",function(e,a,n,t){return{restrict:"EA",scope:{index:"@",animate:"="},replace:!0,transclude:!0,templateUrl:function(e,a){return a.templateUrl||"templates/offcanvas/pane.html"},link:function(r,o,c){function s(){if($.isFunction($.fn.nanoScroller)){var e=$(".offcanvas-body",o);e.length||(e=$(o).wrapInner('<div class="offcanvas-body"></div>'),e=$(".offcanvas-body",o));var a=e.parent();a.hasClass("nano-content")===!1&&e.wrap('<div class="nano"><div class="nano-content"></div></div>');var n=t.innerHeight-$(o).find(".nano").position().top,r=e.closest(".nano");r.css({height:n}),r.nanoScroller({preventPageScrolling:!0})}}o.addClass(c.paneClass||""),r.size=c.size,r.$isRendered=!0;var f=a.defer();c.$observe("offcanvasRender",function(e){"true"==e&&f.resolve()}),f.promise.then(function(){n(function(){s(),r.animate=!0}),angular.element(t).bind("resize",function(){s()});var a=o[0].querySelectorAll("[autofocus]");a.length?a[0].focus():o[0].focus();var c=e.getTop();c&&e.offcanvasRendered(c.key)})}}}]),angular.module("angular.offcanvas").directive("offcanvasStack",["$timeout",function(e){function a(a,n,t){a.animate=!1,e(function(){a.animate=!0})}return{restrict:"EA",replace:!0,templateUrl:"templates/offcanvas/stack.html",compile:function(e,n){return e.addClass(n.stackClass),a}}}]),angular.module("angular.offcanvas").directive("offcanvasTransclude",function(){return{link:function(e,a,n,t,r){r(e.$parent,function(e){a.empty(),a.append(e)})}}}),angular.module("angular.offcanvas").factory("$offcanvasStack",["$animate","$timeout","$document","$compile","$rootScope","$$stackedMap",function(e,a,n,t,r,o){function c(){for(var e=-1,a=g.keys(),n=0;n<a.length;n++)g.get(a[n]).value.backdrop&&(e=n);return e}function s(e){var a=n.find("body").eq(0),t=g.get(e).value;g.remove(e),e.parent&&k.extend(e.parent),i(t.offcanvasDomEl,t.offcanvasScope,function(){a.toggleClass(m,g.length()>0),f()})}function f(){if(v&&-1==c()){var e=p;i(v,p,function(){e=null}),v=void 0,p=void 0}}function i(n,t,o){function c(){c.done||(c.done=!0,n.remove(),t.$destroy(),o&&o())}t.animate=!1,n.attr("offcanvas-animation")&&e.enabled()?n.one("$animate:close",function(){r.$evalAsync(c)}):a(c)}function l(e,a,n){return!e.value.offcanvasScope.$broadcast("offcanvas.closing",a,n).defaultPrevented}var u,d,v,p,m="offcanvas-expanded",g=o.createNew(),k={};return r.$watch(c,function(e){p&&(p.index=e)}),n.bind("keydown",function(e){var a;27===e.which&&(a=g.top(),a&&a.value.keyboard&&(e.preventDefault(),r.$apply(function(){k.dismiss(a.key,"escape key press")})))}),k.open=function(e,o){g.add(e,{deferred:o.deferred,renderDeferred:o.renderDeferred,offcanvasScope:o.scope,backdrop:o.backdrop,keyboard:o.keyboard});var s=n.find("body").eq(0),f=c();if(f>=0&&!v){p=r.$new(!0),p.index=f;var i=angular.element('<div offcanvas-backdrop="offcanvas-backdrop"></div>');i.attr("backdrop-class",o.backdropClass),o.animation&&i.attr("offcanvas-animation","true"),v=t(i)(p),s.append(v)}if(!u){d=r.$new(!0);var l=angular.element('<div offcanvas-stack="offcanvas-stack"></div>');l.attr("stack-class",o.stackClass),u=t(l)(d),s.append(u)}var k=angular.element('<div offcanvas-pane="offcanvas-pane"></div>');k.attr({"template-url":o.paneTemplateUrl,"pane-class":o.paneClass,size:o.size,index:g.length()-1,animate:"animate"}).html(o.content),o.animation&&k.attr("offcanvas-animation","true");var $=t(k)(o.scope);g.top().value.offcanvasDomEl=$,a(function(){u.append($),s.addClass(m)})},k.close=function(e,a){var n=g.get(e);return n&&l(n,a,!0)?(n.value.deferred.resolve(a),s(e),!0):!n},k.dismiss=function(e,a){var n=g.get(e);return n&&l(n,a,!1)?(n.value.deferred.reject(a),s(e),!0):!n},k.reduce=function(e){var a=g.get(e);if(a){var n=a.value.offcanvasDomEl;n.removeClass("offcanvas-opened").addClass("offcanvas-reduced")}},k.extend=function(e){var a=g.get(e);if(a){var n=a.value.offcanvasDomEl;n.removeClass("offcanvas-reduced").addClass("offcanvas-opened")}},k.dismissAll=function(e){for(var a=this.getTop();a&&this.dismiss(a.key,e);)a=this.getTop()},k.getTop=function(){return g.top()},k.offcanvasRendered=function(e){var a=g.get(e);a&&a.value.renderDeferred.resolve()},k}]),angular.module("angular.offcanvas").provider("$offcanvas",function(){var e={options:{animation:!0,backdrop:!1,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$offcanvasStack",function(a,n,t,r,o,c,s){function f(e){return e.template?t.when(e.template):r.get(angular.isFunction(e.templateUrl)?e.templateUrl():e.templateUrl,{cache:o}).then(function(e){return e.data})}function i(e){var n=[];return angular.forEach(e,function(e){(angular.isFunction(e)||angular.isArray(e))&&n.push(t.when(a.invoke(e)))}),n}var l={};return l.open=function(a){var r=t.defer(),o=t.defer(),l=t.defer(),u={result:r.promise,opened:o.promise,rendered:l.promise,close:function(e){return s.close(u,e)},dismiss:function(e){return s.dismiss(u,e)}};if(a.parent&&(u.parent=a.parent),a=angular.extend({},e.options,a),a.resolve=a.resolve||{},!a.template&&!a.templateUrl)throw new Error("One of template or templateUrl options is required.");var d=t.all([f(a)].concat(i(a.resolve)));return d.then(function(e){var t=(a.scope||n).$new();t.$close=u.close,t.$dismiss=u.dismiss;var o,f={},i=1;a.controller&&(f.$scope=t,f.$offcanvasInstance=u,angular.forEach(a.resolve,function(a,n){f[n]=e[i++]}),o=c(a.controller,f),a.controllerAs&&(t[a.controllerAs]=o)),u.parent?s.reduce(u.parent):s.dismissAll(),s.open(u,{scope:t,deferred:r,renderDeferred:l,content:e[0],parent:a.parent,animation:a.animation,backdrop:a.backdrop,keyboard:a.keyboard,backdropClass:a.backdropClass,windowClass:a.windowClass,windowTemplateUrl:a.windowTemplateUrl,size:a.size,target:a.target})},function(e){r.reject(e)}),d.then(function(){o.resolve(!0)},function(e){o.reject(e)}),u},l}]};return e}),angular.module("angular.offcanvas").factory("$$stackedMap",function(){return{createNew:function(){var e=[];return{add:function(a,n){e.push({key:a,value:n})},get:function(a){for(var n=0;n<e.length;n++)if(a==e[n].key)return e[n]},keys:function(){for(var a=[],n=0;n<e.length;n++)a.push(e[n].key);return a},top:function(){return e[e.length-1]},remove:function(a){for(var n=-1,t=0;t<e.length;t++)if(a==e[t].key){n=t;break}return e.splice(n,1)[0]},removeTop:function(){return e.splice(e.length-1,1)[0]},length:function(){return e.length}}}}}),angular.module("angular.offcanvas").run(["$templateCache",function(e){e.put("templates/offcanvas/backdrop.html",'<div class="offcanvas-backdrop fade" ng-click="close($event)" ng-class="{in: animate}"></div>')}]),angular.module("angular.offcanvas").run(["$templateCache",function(e){e.put("templates/offcanvas/pane.html",'<div offcanvas-render="{{$isRendered}}" class="offcanvas-pane width-{{ size ? size : 8 }}" ng-class="{\'offcanvas-opened\': animate}" offcanvas-transclude=""></div>')}]),angular.module("angular.offcanvas").run(["$templateCache",function(e){e.put("templates/offcanvas/stack.html",'<div class="offcanvas"></div>')}]);