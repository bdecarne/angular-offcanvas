angular.module("angular.offcanvas",[]),angular.module("angular.offcanvas").directive("offcanvasAnimationClass",function(){return{compile:function(e,a){a.offcanvasAnimation&&e.addClass(a.offcanvasAnimationClass)}}}),angular.module("angular.offcanvas").directive("offcanvasBackdrop",["$offcanvasStack","$timeout",function(e,a){function n(n,t,o){n.animate=!1,n.close=function(a){var n=e.getTop();n&&n.value.backdrop&&"static"!=n.value.backdrop&&a.target===a.currentTarget&&(a.preventDefault(),a.stopPropagation(),e.dismiss(n.key,"backdrop click"))},a(function(){n.animate=!0})}return{restrict:"EA",replace:!0,templateUrl:"templates/offcanvas/backdrop.html",compile:function(e,a){return e.addClass(a.backdropClass),n}}}]),angular.module("angular.offcanvas").directive("offcanvasPane",["$offcanvasStack","$q","$timeout","$window","$document",function(e,a,n,t,o){return{restrict:"EA",scope:{index:"@",animate:"="},replace:!0,transclude:!0,templateUrl:function(e,a){return a.templateUrl||"templates/offcanvas/pane.html"},link:function(o,r,s){function c(){if("undefined"!=typeof jQuery&&jQuery.isFunction(jQuery.fn.nanoScroller)){var e=jQuery(".offcanvas-body",r);e.length||(e=jQuery(r).wrapInner('<div class="offcanvas-body"></div>'),e=jQuery(".offcanvas-body",r));var a=e.parent();a.hasClass("nano-content")===!1&&e.wrap('<div class="nano"><div class="nano-content"></div></div>');var n=jQuery(r).find(".nano"),t=n.parent().innerHeight()-(n.position().top-n.parent().position().top),o=e.closest(".nano");o.css({height:t}),o.nanoScroller({preventPageScrolling:!0})}}r.addClass(s.paneClass||""),r.addClass(s.position),o.size=s.size,o.$isRendered=!0;var i=a.defer();o.$watch("$id",function(e){i.resolve()}),s.$observe("offcanvasSize",function(e){r.addClass(s.paneClass||"")}),o.$watch(function(){return r.attr("index")},function(e){r.css({zIndex:1050+e})}),i.promise.then(function(){n(function(){c(),o.animate=!0}),angular.element(t).bind("resize",function(){c()});var a=r[0].querySelectorAll("[autofocus]");a.length?a[0].focus():r[0].focus();var s=e.getTop();s&&e.offcanvasRendered(s.key)})}}}]),angular.module("angular.offcanvas").directive("offcanvasStack",[function(){return{restrict:"EA",replace:!0,templateUrl:"templates/offcanvas/stack.html"}}]),angular.module("angular.offcanvas").directive("offcanvasTransclude",function(){return{link:function(e,a,n,t,o){o(e.$parent,function(e){a.empty(),a.append(e)})}}}),angular.module("angular.offcanvas").factory("$offcanvasStack",["$animate","$timeout","$document","$compile","$rootScope","$$stackedMap",function(e,a,n,t,o,r){function s(){for(var e=-1,a=k.keys(),n=0;n<a.length;n++)k.get(a[n]).value.backdrop&&(e=n);return e}function c(e,a){var n=k.get(e).value;e.parent&&h.extend(e.parent);for(var t=k.keys(),o=0;o<t.length;o++)t[o].parent==e&&h.close(t[o]);k.remove(e),f(n.offcanvasDomEl,n.offcanvasScope,function(){$.toggleClass(m,k.length()>0),i(),a&&a()})}function i(){if(p&&-1==s()){var e=v;$.removeClass(g),f(p,v,function(){e=null}),p=void 0,v=void 0}}function f(n,t,r){function s(){s.done||(s.done=!0,n.remove(),t.$destroy(),r&&r())}t.animate=!1,n.attr("offcanvas-animation")&&e.enabled()?"undefined"!=typeof e.on?e.on("removeClass",n,function(e,a){"close"==a&&o.$evalAsync(s)}):n.one("$animate:close",function(){o.$evalAsync(s)}):a(s)}function l(e,a,n){return!e.value.offcanvasScope.$broadcast("offcanvas.closing",a,n).defaultPrevented}var u,d,p,v,m="offcanvas-opened",g="offcanvas-with-backdrop",k=r.createNew(),h={},$=n.find("body").eq(0);d=o.$new(!0);var y=angular.element('<div offcanvas-stack="offcanvas-stack"></div>');return u=t(y)(d),$.append(u),o.$watch(s,function(e){v&&(v.index=e)}),n.bind("keydown",function(e){var a;27===e.which&&(a=k.top(),a&&a.value.keyboard&&(e.preventDefault(),o.$apply(function(){h.dismiss(a.key,"escape key press")})))}),h.open=function(e,r){k.add(e,{deferred:r.deferred,renderDeferred:r.renderDeferred,closedDeferred:r.closedDeferred,offcanvasScope:r.scope,backdrop:r.backdrop,keyboard:r.keyboard,target:r.target});var c=s();if(c>=0&&!p){v=o.$new(!0),v.index=c;var i=angular.element('<div offcanvas-backdrop="offcanvas-backdrop"></div>');i.attr("backdrop-class",r.backdropClass),r.animation&&i.attr("offcanvas-animation","true"),p=t(i)(v),$.append(p),$.addClass(g)}var f=r.compileFunc(r.scope);console.log(f),f.attr("index",k.length()-1),r.animation&&f.attr("offcanvas-animation","true"),k.top().value.offcanvasDomEl=f,a(function(){u.append(f),$.addClass(m),r.closeOnOutsideClick&&n.bind("click",function(a){for(var n=0,t=a.target;t;t=t.parentNode){if(angular.element(t).hasClass("offcanvas-pane"))return;n++}o.$apply(function(){e.dismiss("click outside")}),angular.element(this).off(a)})})},h.close=function(e,a){var n=k.get(e);return n&&l(n,a,!0)?(n.value.deferred.resolve(a),c(e,function(){n.value.closedDeferred.resolve()}),!0):!n},h.dismiss=function(e,a){var n=k.get(e);return n&&l(n,a,!1)?(n.value.deferred.reject(a),c(e,function(){n.value.closedDeferred.resolve()}),!0):!n},h.reduce=function(e){var a=k.get(e);if(a){var n=a.value.offcanvasDomEl;n.removeClass("offcanvas-opened").addClass("offcanvas-reduced")}},h.extend=function(e){var a=k.get(e);if(a){var n=a.value.offcanvasDomEl;n.removeClass("offcanvas-reduced").addClass("offcanvas-opened")}},h.dismissAll=function(e){for(var a=this.getTop();a&&this.dismiss(a.key,e);)a=this.getTop()},h.getTop=function(){return k.top()},h.getByTarget=function(e){for(var a=k.keys(),n=0;n<a.length;n++){var t=k.get(a[n]);if(t.value.target&&t.value.target==e)return a[n]}},h.setTop=function(e){var n=k.get(e);if(n){{n.value.offcanvasDomEl}a(function(){k.remove(e),k.add(n.key,n.value),h.resetIndexAttributes()})}},h.resetIndexAttributes=function(){for(var e=k.keys(),a=0;a<e.length;a++){var n=k.get(e[a]),t=n.value.offcanvasDomEl;t.attr("index",a)}},h.offcanvasRendered=function(e){var a=k.get(e);a&&a.value.renderDeferred.resolve()},h}]),angular.module("angular.offcanvas").provider("$offcanvas",function(){var e={options:{animation:!0,backdrop:!1,keyboard:!0,dismissAll:!0,position:"right"},$get:["$injector","$rootScope","$q","$http","$compile","$templateCache","$controller","$offcanvasStack",function(a,n,t,o,r,s,c,i){function f(e){return e.template?t.when(e.template):o.get(angular.isFunction(e.templateUrl)?e.templateUrl():e.templateUrl,{cache:s}).then(function(e){return e.data})}function l(e){var n=[];return angular.forEach(e,function(e){(angular.isFunction(e)||angular.isArray(e))&&n.push(t.when(a.invoke(e)))}),n}var u={};return u.prepare=function(a){var n=t.defer();if(a.parent&&!a.position&&a.parent.options.position&&(a.position=a.parent.options.position),a=angular.extend({},e.options,a),!a.template&&!a.templateUrl)throw new Error("One of template or templateUrl options is required.");return f(a).then(function(e){var t=angular.element('<div offcanvas-pane="offcanvas-pane"></div>');t.attr({"template-url":a.paneTemplateUrl,"pane-class":a.paneClass,size:a.size,animate:"animate",position:a.position}).html(e),a.animation&&t.attr("offcanvas-animation","true");var o=r(t);a.compileFunc=o,n.resolve(a)},function(e){n.reject(e)}),n.promise},u.open=function(e){function a(e){e.resolve=e.resolve||{},t.all(l(e.resolve)).then(function(a){var t=(e.scope||n).$new();t.$close=o.close,t.$dismiss=o.dismiss;var s,l={},u=0;e.controller&&(l=angular.copy(a),l.$scope=t,l.$offcanvasInstance=o,angular.forEach(e.resolve,function(e,n){l[n]=a[u++]}),s=c(e.controller,l),e.controllerAs&&(t[e.controllerAs]=s)),o.parent?i.reduce(o.parent):e.dismissAll&&i.dismissAll(),i.open(o,{scope:t,deferred:r,renderDeferred:f,closedDeferred:d,compileFunc:e.compileFunc,parent:e.parent,animation:e.animation,backdrop:e.backdrop,keyboard:e.keyboard,backdropClass:e.backdropClass,paneClass:e.paneClass,paneTemplateUrl:e.paneTemplateUrl,size:e.size,target:e.target,position:e.position,closeOnOutsideClick:e.closeOnOutsideClick})})}if(e.target){var o=i.getByTarget(e.target);if(o)return i.setTop(o),o}var r=t.defer(),s=t.defer(),f=t.defer(),d=t.defer(),o={result:r.promise,opened:s.promise,rendered:f.promise,closed:d.promise,close:function(e){return i.close(o,e)},dismiss:function(e){return i.dismiss(o,e)}};return e.parent&&(o.parent=e.parent),o.options=e,e.compileFunc?a(e):u.prepare(e).then(function(){a(e)}),o},u}]};return e}),angular.module("angular.offcanvas").factory("$$stackedMap",function(){return{createNew:function(){var e=[];return{add:function(a,n){e.push({key:a,value:n})},get:function(a){for(var n=0;n<e.length;n++)if(a==e[n].key)return e[n]},keys:function(){for(var a=[],n=0;n<e.length;n++)a.push(e[n].key);return a},top:function(){return e[e.length-1]},remove:function(a){for(var n=-1,t=0;t<e.length;t++)if(a==e[t].key){n=t;break}return e.splice(n,1)[0]},removeTop:function(){return e.splice(e.length-1,1)[0]},length:function(){return e.length},all:function(){return e}}}}}),angular.module("angular.offcanvas").run(["$templateCache",function(e){e.put("templates/offcanvas/backdrop.html",'<div class="offcanvas-backdrop" offcanvas-animation-class="fade" ng-click="close($event)" ng-class="{in: animate}"></div>')}]),angular.module("angular.offcanvas").run(["$templateCache",function(e){e.put("templates/offcanvas/pane.html",'<div offcanvas-render="{{$isRendered}}" test="{{$id}}" class="offcanvas-pane" ng-class="[animate ? \'offcanvas-opened\' : \'\', size ? \'width-\' + size : \'width-8\']" offcanvas-transclude=""></div>')}]),angular.module("angular.offcanvas").run(["$templateCache",function(e){e.put("templates/offcanvas/stack.html",'<div class="offcanvas-stack"></div>')}]);